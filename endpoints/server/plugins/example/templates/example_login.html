<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenNHP Demo</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f0f4f8;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .container {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            width: 640px;
            transition: width 0.3s ease;
        }

        .container.expanded {
            width: 800px;
        }

        h1 {
            color: #3498db;
            text-align: center;
        }

        .input-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: #555;
        }

        input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        button {
            width: 100%;
            padding: 0.75rem;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #2980b9;
        }

        .note {
            text-align: center;
            margin-top: 1rem;
            font-size: 1.1rem;
            color: #777;
        }

        .status {
            margin-bottom: 1.5rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 1rem;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .status-label {
            font-weight: 600;
            padding-right: 0.5rem;
        }

        .status-value {
            font-weight: 300;
        }

        .timeout {
            color: #e74c3c;
        }

        .success {
            color: #2ecc71;
        }

        .language-select {
            text-align: right;
            margin-bottom: 1rem;
        }

        select {
            padding: 0.25rem;
        }

        #message {
            margin-top: 1rem;
            font-size: 1.2rem;
            color: #2ecc71;  
            display: none;  
            text-align: center;
        }

        .countdown-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0;
            white-space: nowrap;  
            min-width: 200px;  
            margin-top: 1rem;  
        }

        #countdown {
            font-size: 1.5rem;
            font-weight: bold;
            margin-right: 0.5rem;
        }

        #timeUnit {
            font-size: 1.2rem;
        }

        #welcomeMessage {
            font-size: 1.3rem;
            margin-right: 0.5rem;
        }

        .note a {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
    </style>
</head>
<body>
    <div class="container" id="mainContainer">
        <div class="language-select" id="languageSelectContainer">
            <select id="languageSelect" onchange="changeLanguage()">
                <option value="en">English</option>
                <option value="zh">中文</option>
                <option value="es">Español</option>
            </select>
        </div>
        <h1 id="title">OpenNHP Demo</h1>
        <div class="status">
            <p class="note">
                <span id="protectedServer">The Protected Server is</span> 
                <a href="https://acdemo.opennhp.org" target="_blank">https://acdemo.opennhp.org</a>. 
                (<a href="https://dnschecker.org/port-scanner.php?query=acdemo.opennhp.org" target="_blank" id="scanPorts">Scan Its Ports &gt;&gt;</a>)
            </p>
            <div class="status-item">
                <span class="status-label" id="beforeLogin">Before Login: </span>
                <span class="status-value timeout" id="timeoutStatus">Connection to the Protected Server should be <strong>TIMEOUT. ❌</strong></span>
            </div>
            <div class="status-item">
                <span class="status-label" id="afterLogin">After Login: </span>
                <span class="status-value success" id="successStatus">Connection to the Protected Server should be <strong>SUCCESSFUL. ✅</strong></span>
            </div>
        </div>     
        <form id="loginForm" onsubmit="return nhpValidate()">
            <div class="input-group">
                <label for="username" id="usernameLabel">Username:</label>
                <input type="text" id="username" name="username" value="user">
            </div>
            <div class="input-group">
                <label for="password" id="passwordLabel">Password:</label>
                <input type="password" id="password" name="password" value="password">
            </div>
            <button type="submit" id="loginButton">Login</button>
            <div style="text-align: center;">
            </br>
            <div style="text-align: center; display: inline-flex; align-items: center; gap: 8px;">
                <a href="https://nhp.opennhp.org/plugins/okta?resid=demo&action=oauth" style="display: flex; align-items: center;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 109.21 36" role="img" aria-labelledby="okta-logo" style="width: 100px; height: 40px;">
                        <title id="okta-logo">Okta Login</title>
                        <path d="M98.97,23.67c-3.05,0-5.2-2.38-5.2-5.51s2.15-5.51,5.2-5.51,5.14,2.38,5.14,5.51-2.12,5.51-5.14,5.51Zm-.49,3.28c2.46,0,4.55-.96,5.87-2.97,.25,1.95,1.66,2.66,3.44,2.66h1.42v-3.09h-.61c-1.01,0-1.26-.49-1.26-1.64V9.69h-3.26v2.51c-1.11-1.76-3.2-2.82-5.6-2.82-4.28,0-8.21,3.59-8.21,8.78s3.94,8.78,8.21,8.78Zm-16.79-4.24c0,2.78,1.72,3.93,3.78,3.93h3.97v-3.09h-2.89c-1.2,0-1.45-.46-1.45-1.64V12.78h4.34v-3.09h-4.34V4h-3.41V22.71Zm-15.53,3.93h3.41v-7.27h1.14l5.81,7.27h4.31l-7.41-9.22,5.69-7.73h-3.84l-4.65,6.53h-1.05V4h-3.41V26.64Zm-11.07-17.26c-4.77,0-8.7,3.59-8.7,8.78s3.94,8.78,8.7,8.78,8.7-3.59,8.7-8.78-3.94-8.78-8.7-8.78Zm0,14.29c-3.05,0-5.2-2.38-5.2-5.51s2.15-5.51,5.2-5.51,5.2,2.38,5.2,5.51-2.15,5.51-5.2,5.51Z" fill="current"></path>
                        <path d="M19.8,.26l-.74,9.12c-.35-.04-.7-.06-1.06-.06-.45,0-.89,.03-1.32,.1l-.42-4.42c-.01-.14,.1-.26,.24-.26h.75l-.36-4.47c-.01-.14,.1-.26,.23-.26h2.45c.14,0,.25,.12,.23,.26h0Zm-6.18,.45c-.04-.13-.18-.21-.31-.16l-2.3,.84c-.13,.05-.19,.2-.13,.32l1.87,4.08-.71,.26c-.13,.05-.19,.2-.13,.32l1.91,4.01c.69-.38,1.44-.67,2.23-.85L13.63,.71ZM7.98,3.25l5.29,7.46c-.67,.44-1.28,.96-1.8,1.56l-3.17-3.12c-.1-.1-.09-.26,.01-.35l.58-.48-3.15-3.19c-.1-.1-.09-.26,.02-.35l1.87-1.57c.11-.09,.26-.07,.34,.04ZM3.54,7.57c-.11-.08-.27-.04-.34,.08l-1.22,2.12c-.07,.12-.02,.27,.1,.33l4.06,1.92-.38,.65c-.07,.12-.02,.28,.11,.33l4.04,1.85c.29-.75,.68-1.45,1.16-2.08L3.54,7.57ZM.55,13.33c.02-.14,.16-.22,.29-.19l8.85,2.31c-.23,.75-.36,1.54-.38,2.36l-4.43-.36c-.14-.01-.24-.14-.21-.28l.13-.74-4.47-.42c-.14-.01-.23-.14-.21-.28l.42-2.41h0Zm-.33,5.98c-.14,.01-.23,.14-.21,.28l.43,2.41c.02,.14,.16,.22,.29,.19l4.34-1.13,.13,.74c.02,.14,.16,.22,.29,.19l4.28-1.18c-.25-.74-.41-1.53-.45-2.34L.21,19.31Zm1.42,6.34c-.07-.12-.02-.27,.1-.33l8.26-3.92c.31,.74,.73,1.43,1.23,2.05l-3.62,2.58c-.11,.08-.27,.05-.34-.07l-.38-.66-3.69,2.55c-.11,.08-.27,.04-.34-.08l-1.23-2.12Zm10.01-1.72l-6.43,6.51c-.1,.1-.09,.26,.02,.35l1.88,1.57c.11,.09,.26,.07,.34-.04l2.6-3.66,.58,.49c.11,.09,.27,.07,.35-.05l2.52-3.66c-.68-.42-1.31-.93-1.85-1.51Zm-1.27,10.45c-.13-.05-.19-.2-.13-.32l3.81-8.32c.7,.36,1.46,.63,2.25,.78l-1.12,4.30c-.03,.13-.18,.21-.31,.16l-.71-.26-1.19,4.33c-.04,.13-.18,.21-.31,.16l-2.3-.84h0Zm6.56-7.75l-.74,9.12c-.01,.14,.1,.26,.23,.26h2.45c.14,0,.25-.12,.23-.26l-.36-4.47h.75c.14,0,.25-.12,.24-.26l-.42-4.42c-.43,.07-.87,.1-1.32,.1-.36,0-.71-.02-1.06-.07h0ZM25.76,1.94c.06-.13,0-.27-.13-.32l-2.3-.84c-.13-.05-.27,.03-.31,.16l-1.19,4.33-.71-.26c-.13-.05-.27,.03-.31,.16l-1.12,4.30c.8,.16,1.55,.43,2.25,.78L25.76,1.94h0Zm5.02,3.63l-6.43,6.51c-.54-.58-1.16-1.09-1.85-1.51l2.52-3.66c.08-.11,.24-.14,.35-.05l.58,.49,2.6-3.66c.08-.11,.24-.13,.34-.04l1.88,1.57c.11,.09,.11,.25,.02,.35Zm3.48,5.12c.13-.06,.17-.21,.1-.33l-1.23-2.12c-.07-.12-.23-.15-.34-.08l-3.69,2.55-.38-.65c-.07-.12-.23-.16-.34-.07l-3.62,2.58c.5,.62,.91,1.31,1.23,2.05l8.26-3.92Zm1.3,3.32l.42,2.41c.02,.14-.07,.26-.21,.28l-9.11,.85c-.04-.82-.2-1.6-.45-2.34l4.28-1.18c.13-.04,.27,.05,.29,.19l.13,.74,4.34-1.13c.13-.03,.27,.05,.29,.19h0Zm-.41,8.85c.13,.03,.27-.05,.29-.19l.42-2.41c.02-.14-.07-.26-.21-.28l-4.47-.42,.13-.74c.02-.14-.07-.26-.21-.28l-4.43-.36c-.02,.82-.15,1.61-.38,2.36l8.85,2.31h0Zm-2.36,5.50c-.07,.12-.23,.15-.34,.08l-7.53-5.20c.48-.63,.87-1.33,1.16-2.08l4.04,1.85c.13,.06,.18,.21,.11,.33l-.38,.65,4.06,1.92c.12,.06,.17,.21,.10,.33l-1.22,2.12h0Zm-10.07-3.07l5.29,7.46c.08,.11,.24,.13,.34,.04l1.87-1.57c.11-.09,.11-.25,.02-.35l-3.15-3.19,.58-.48c.11-.09,.11-.25,.01-.35l-3.17-3.12c-.53,.60-1.13,1.13-1.80,1.56h0Zm-.05,10.16c-.13,.05-.27-.03-.31-.16l-2.42-8.82c.79-.18,1.54-.47,2.23-.85l1.91,4.01c.06,.13,0,.28-.13,.32l-.71,.26,1.87,4.08c.06,.13,0,.27-.13,.32l-2.30,.84h0Z" fill="current" fill-rule="evenodd"></path>
                    </svg>
                </a>
                <a href="https://nhp.opennhp.org/plugins/okta?resid=demo&action=oauth"><span style="font-family: Arial, sans-serif; font-size: 16px; color: #000; font-weight: 500; line-height: 1;">Login</span></a> | 
                                <a href="https://nhp.opennhp.org/plugins/okta?resid=demo&action=logout"><span style="font-family: Arial, sans-serif; font-size: 16px; color: #000; font-weight: 500; line-height: 1;">Logout</span></a>
            </div>
            </div>

        </form>
        <div id="message">
            <h2 id="authSuccessMessage"></h2>

            <div class="message-content">
                <span id="redirectMessage"></span> 
                <a href="" id="redirectUrl"></a>
            </div>
            <div class="countdown-container">
                <div id="welcomeMessage"></div> 
                <span id="countdown">5</span>
                <span id="timeUnit"></span>
            </div>
        </div> 
        <div class="countdown-container">
        <div id="ip-display" style="color: #777;">Fetching IP...</div>
        </div>
    </div>

    <script>
        const translations = {
            en: {
                title: "OpenNHP Demo",
                protectedServer: "The Protected Server is",
                scanPorts: "Scan Its Ports >>",
                beforeLogin: "Before Login:",
                afterLogin: "After Login:",
                timeoutStatus: "Connection to the Protected Server should be TIMEOUT. ❌",
                successStatus: "Connection to the Protected Server should be SUCCESSFUL. ✅",
                usernameLabel: "Username:",
                passwordLabel: "Password:",
                loginButton: "Login",
                authSuccess: "Authentication Succeeded!",
                redirectMessage: "You can now access",
                timeUnit: "   seconds ...",
                welcomeMessage: "Redirecting in"
            },
            zh: {
                title: "OpenNHP 演示",
                protectedServer: "受保护的服务器是",
                scanPorts: "扫描其端口 >>",
                beforeLogin: "登录前：",
                afterLogin: "登录后：",
                timeoutStatus: "与受保护服务器的连接应为超时。❌",
                successStatus: "与受保护服务器的连接应该成功。✅",
                usernameLabel: "用户名：",
                passwordLabel: "密码：",
                loginButton: "登录",
                authSuccess: "认证成功！",
                redirectMessage: "您现在可以访问",
                timeUnit: "   秒后自动跳转...",
                welcomeMessage: ""
            },
            es: {
                title: "Demostración de OpenNHP",
                protectedServer: "El Servidor Protegido es",
                scanPorts: "Escanear Sus Puertos >>",
                beforeLogin: "Antes del Inicio de Sesión:",
                afterLogin: "Después del Inicio de Sesión:",
                timeoutStatus: "La conexión al Servidor Protegido debe ser TIEMPO DE ESPERA. ❌",
                successStatus: "La conexión al Servidor Protegido debe ser EXITOSA. ✅",
                usernameLabel: "Nombre de Usuario:",
                passwordLabel: "Contraseña:",
                loginButton: "Iniciar Sesión",
                authSuccess: "¡Autenticación Exitosa!",
                redirectMessage: "Ahora puedes acceder a",
                timeUnit: "   segundo...",
                welcomeMessage: "Saltar automáticamente después de"
            }
        };

        function changeLanguage() {
            const lang = document.getElementById('languageSelect').value;
            const container = document.getElementById('mainContainer');
            if (lang === 'es') {
                container.classList.add('expanded');
            } else {
                container.classList.remove('expanded');
            }
            document.documentElement.lang = lang;
            const t = translations[lang];

            document.getElementById('title').textContent = t.title;
            document.getElementById('protectedServer').textContent = t.protectedServer;
            document.getElementById('scanPorts').textContent = t.scanPorts;
            document.getElementById('beforeLogin').textContent = t.beforeLogin;
            document.getElementById('afterLogin').textContent = t.afterLogin;
            document.getElementById('timeoutStatus').textContent = t.timeoutStatus;
            document.getElementById('successStatus').textContent = t.successStatus;
            document.getElementById('usernameLabel').textContent = t.usernameLabel;
            document.getElementById('passwordLabel').textContent = t.passwordLabel;
            document.getElementById('loginButton').textContent = t.loginButton;
        }

        function nhpValidate() {
            const user = document.getElementById("username").value;
            const password = document.getElementById("password").value;
            const nhpValidUrl = "https://nhp.opennhp.org/plugins/example?resid=demo&action=valid" + 
            "&username=" + encodeURIComponent(user) + 
            "&password=" + encodeURIComponent(password);
            console.log(nhpValidUrl);

            fetch(nhpValidUrl)
            .then(response => response.json())
            .then(result => {
                console.log(result);
                const lang = document.getElementById('languageSelect').value;  
                const t = translations[lang];  
                const messageElement = document.getElementById("message");
                const authSuccessMessageElement = document.getElementById("authSuccessMessage");
                const welcomeMessageElement = document.getElementById("welcomeMessage");
                const redirectMessageElement = document.getElementById("redirectMessage");
                const redirectUrlElement = document.getElementById("redirectUrl");
                const timeUnitElement = document.getElementById('timeUnit');

                if (result && result.redirectUrl) {

                    document.getElementById('languageSelectContainer').style.display = 'none';

                    redirectUrlElement.href = result.redirectUrl;
                    redirectUrlElement.textContent = result.redirectUrl;
                    authSuccessMessageElement.textContent = t.authSuccess;
                    welcomeMessageElement.textContent = t.welcomeMessage; 
                    redirectMessageElement.textContent = t.redirectMessage;
                    messageElement.style.display = 'block';
                    document.getElementById("loginForm").style.display = "none"; 

                    let countdown = 5;
                    const countdownElement = document.getElementById('countdown');
                    const intervalId = setInterval(() => {
                        countdown -= 1;
                        if (countdown <= 0) {
                            clearInterval(intervalId);
                            window.location.href = result.redirectUrl;
                        } else {
                            countdownElement.textContent = countdown;
                        }
                    }, 1000);
                    timeUnitElement.textContent = t.timeUnit;

                } else {
                    if (result.errMsg) {
                        alert(result.errMsg);
                    } else {
                        alert("Invalid username or password");
                    }
                }
            })
            .catch(error => {
                alert(error.message);
            });
            return false; 
        }

        document.addEventListener('DOMContentLoaded', () => {
            const userLang = navigator.language || navigator.userLanguage;
            const lang = userLang.startsWith('es') ? 'es' : (userLang.startsWith('zh') ? 'zh' : 'en');
            document.getElementById('languageSelect').value = lang;
            changeLanguage(); 
            fetchIP();
        });
    
        async function fetchIP() {
            try {
                                    const response = await fetch('https://ipinfo.io/json');
                const data = await response.json();
                document.getElementById('ip-display').textContent = "(IP Address:"+data.ip+")";
            } catch (error) {
                document.getElementById('ip-display').textContent = "Failed to get IP, please refresh";
                console.error("Fetch ip error:", error);
            }
        }
    </script>
</body>
</html>